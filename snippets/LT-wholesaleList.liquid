<link rel="stylesheet" href="{{ 'quick-add.css' | asset_url }}" media="print" onload="this.media='all'">
<div class="flex flex-nowrap">
    <div class="relative w-[100px] h-[100px]">
      <img src="{{card_product.featured_image | img_url:'100x'}}" alt="" class="absolute object-cover w-full h-full p-2 rounded-md aspaect-square" loading="lazy">
    </div>

    <div class="flex flex-col w-1/3 px-2 text-base">
      {{card_product.title | truncate:90}}
    </div>

    <!-- <div class="flex flex-nowrap">
        <form method="post" action="/cart/add">
          <input type="hidden" name="id" value="{{ product.variants.first.id }}" />
          <input name="options[prefix]" type="hidden" value="last">
          <input type="hidden" type="number" id="quantity" name="quantity" value="1"/>
          <input type="submit" value="Add to cart" class="btn" />
        </form>
    </div> -->

    <!-- basic add to cart function works but selector quantity limit doesn't work -->
    <!-- <form action="/cart/add" method="post" style="text-align:center;">
      <select name="id">
      {% for variant in card_product.variants %}
        {% if variant.available %}
        <option value="{{ variant.id }}">{{ variant.title }} - {{ variant.price | money }} ({{variant.inventory_quantity}})</option>
        {% else %}
        <option disabled="disabled">{{ variant.title }} - Sold Out</option>
        {% endif %}
        {% assign selected_variant = variant.title %}
      {% endfor %}
      </select>
      <label for="Quantity" >Quantity: </label>
      <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{card_product.selected_or_first_available_variant.inventory_quantity}}">
      <button type="submit" value="Buy now" />Add</button>
    </form> -->

<!-- module copied from quick buy -->
<div class="quick-add">
  {%- assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id -%}
  {%- if card_product.has_only_default_variant -%}
    <product-form>
      {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
        <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
        <button
          id="{{ product_form_id }}-submit"
          type="submit"
          name="add"
          class="quick-add__submit button button--full-width button--secondary"
          aria-haspopup="dialog"
          aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
          aria-live="polite"
          data-sold-out-message="true"
        {% if card_product.selected_or_first_available_variant.available == false %}disabled{% endif %}
        >
            <span>
              {%- if card_product.selected_or_first_available_variant.available -%}Add to Cart{%- else -%}Sold Out{%- endif -%}
            </span>
            <span class="hidden sold-out-message">Sold Out</span>
            <div class="hidden loading-overlay__spinner">
              <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
              </svg>
            </div>
        </button>
      {%- endform -%}
    </product-form>
  {%- else -%}
    <modal-opener data-modal="#QuickAdd-{{ card_product.id }}">
      <button
        id="{{ product_form_id }}-submit"
        type="submit"
        name="add"
        class="quick-add__submit button button--full-width button--secondary"
        aria-haspopup="dialog"
        aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
        data-product-url="{{ card_product.url }}"
      >Choice<div class="hidden loading-overlay__spinner">
          <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
            <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
          </svg>
        </div>
      </button>
    </modal-opener>
    <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal">
      <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content" tabindex="-1">
        <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">{% render 'icon-close' %}</button>
        <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info">
        </div>
      </div>          
    </quick-add-modal>
  {%- endif -%}
</div>

  
</div>