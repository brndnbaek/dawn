{% comment %}
    Renders a product card

    Accepts:
    - card_product: {Object} Product Liquid object (optional)
    - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
    - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
    - show_vendor: {Boolean} Show the product vendor. Default: false
    - show_rating: {Boolean} Show the product rating. Default: false
    - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
    - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)

    Usage:
    {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}
{% assign my_meta = card_product.metafields.my_fields %}    

<div class="LT_productCard relative w-full ml-10 md:ml-[3rem] h-full mt-3 md:mt-[2rem] bg-white shadow-md backdrop-blur-xl bg-opacity-40 rounded-lg group grow-0 shrink-0 antialiased shadow-neutral-300" >
  {% assign image_def = card_product.featured_media.aspect_ratio %}
  {% if image_def > 1.3 %}
  <div class="absolute w-[240px] md:w-[19rem] h-auto top-2 -left-8 md:top-[2rem] md:-left-[1.5rem] group-hover:scale-110 group-hover:duration-500 transition group-hover:-translate-x-6 group-hover:-translate-y-6">
    <a href="{{card_product.url}}" class="no-underline text-neutral-800">
      <img src="{{card_product.featured_media | image_url: height:350}}" alt="" class="object-cover w-full h-full origin-bottom-right rounded-lg shadow-md shadow-neutral-400" loading=lazy></a>
      <!-- {% capture the_snippet_fave_icon %}{% render 'LT-widget-faveicon' with card_product.id %}{% endcapture %}
        {% unless the_snippet_fave_icon contains 'Liquid error' %}
            {{ the_snippet_fave_icon }}
        {% endunless %} -->
  </div>
  
  {% elsif image_def < 0.85 %}
  <div class="absolute h-[80%] max-h-[80%] md:max-h-[18rem] -top-[1rem] md:-top-[1.5rem] left-12  md:left-[1.5rem] max-w-[45%] md:max-w-[15rem] top-0 group-hover:-translate-x-6 group-hover:-translate-y-6 group-hover:scale-110 duration-500">
    <a href="{{card_product.url}}" class="no-underline text-neutral-800">
      <img src="{{card_product.featured_media | image_url: height:350}}" alt="" class="relative object-cover object-top w-full h-full origin-bottom-right rounded-lg shadow-md shadow-neutral-400" loading=lazy></a>
      <!-- {% capture the_snippet_fave_icon %}{% render 'LT-widget-faveicon' with card_product.id %}{% endcapture %}
        {% unless the_snippet_fave_icon contains 'Liquid error' %}
            {{ the_snippet_fave_icon }}
        {% endunless %} -->
      </div>
    {% else %}

  <div class="absolute w-[190px] md:w-[60%] bottom-[5.5rem] -left-[1.5rem] h-auto group-hover:-translate-x-4 group-hover:-translate-y-4 group-hover:scale-105 group-hover:duration-500 duration-500 group-hover:transition-all">
    <a href="{{card_product.url}}" class="no-underline text-neutral-800">
      <img src="{{card_product.featured_media | image_url: height:350}}" alt="" class="relative object-cover w-full h-full rounded-lg shadow-md shadow-neutral-400" loading=lazy></a>
        <!-- <div class="absolute top-0 right-0 scale-75" > -->
          <!-- {% capture the_snippet_fave_icon %}{% render 'LT-widget-faveicon' with card_product.id %}{% endcapture %}
        {% unless the_snippet_fave_icon contains 'Liquid error' %}
            {{ the_snippet_fave_icon }}
        {% endunless %} -->
        <!-- </div> -->
  </div>
  {%endif%}

  <!-- Title box absolute location and style per image ratio  -->
  {%if card_product.tags contains 'model kit' %}
  <div class="flex flex-col items-center justify-end w-full h-full px-8 pb-1 ">
    <div class="relative mx-auto text-xl font-semibold leading-tight text-center break-words group-hover:text-indigo-800 h-[4.5rem]">
      <a href="{{card_product.url}}" class="no-underline text-neutral-800">
        {{card_product.title | escape | remove_first:my_meta.brand | truncate:80}}
      
      <div class="absolute inset-0 w-full h-full bg-indigo-200 opacity-30 group-hover:opacity-50 filter rounded-xl blur-lg mix-blend-darken"> </div></a>
    </div>
  </div>
  
  {%elsif card_product.type == 'Kpop CD' %}
  <div class="flex flex-col items-center justify-end w-full h-full px-4 pb-1">
    <div class="relative mx-auto text-xl font-semibold leading-tight text-center break-words text-neutral-800 ">
      <a href="{{card_product.url}}" class="no-underline text-neutral-800">{{card_product.title | escape |remove:'K-Pop'|remove:'K-pop' | remove:'CD' | replace_first: "&#39;", "<br />'" | truncate:80}}
      <div class="absolute inset-0 w-full h-full bg-indigo-200 opacity-30 group-hover:opacity-50 filter rounded-xl blur-lg mix-blend-darken"> </div></a>
    </div>
  </div>
  {%else %}
  <div class="flex flex-col items-center justify-end w-full h-full px-8 pb-1">
    <div class="relative mx-auto text-xl font-semibold leading-tight text-center break-words text-neutral-800 ">
      <a href="{{card_product.url}}" class="no-underline text-neutral-800">{{card_product.title | escape | truncate:80}}
      <div class="absolute inset-0 w-full h-full bg-indigo-200 opacity-30 group-hover:opacity-50 filter rounded-xl blur-lg mix-blend-darken"> </div>
    </a>
    </div>
  </div>
  {%endif%}


  <!-- whole block linkable trick -->
  <!-- <a href="{{card_product.url}}"><span class="absolute top-0 left-0 z-10 w-1/2 h-full"></span></a> -->
  
  <!-- pricing box  -->
  <div class="absolute top-[55%] right-[1.25rem] rounded-lg px-2 py-1 drop-shadow-lg text-neutral-600  {%if card_product.available %} group-hover:bg-rose-200{%else%} group-hover:bg-neutral-300{%endif%} group-hover:duration-500 duration-500">
    <a href="{{card_product.url}}" class="{%if card_product.available%}no-underline {%else%}line-through{%endif%}">
      {% render 'LTprice2', product: card_product, price_class: 'text-center text-slate-700 font-semibold text-2xl' %}
    </a>
    
    
    
  </div>
  
  <!-- top-right sub description box -->
  <div class="absolute mx-auto top-4 {%if image_def < 0.8 %} w-[40%] md:w-[40%] right-0{%elsif image_def > 1.2 %}w-1/3 right-0{%else%} w-2/5 right-0{%endif%}">
    <div class="flex flex-col items-start list-none gap-y-1">
      
      <!-- conditional list to show artist link either collection or by searh -->
      {% capture artist %}{{my_meta.artist | handle}}{%endcapture%}
      {%if collections[artist].products.size != 0 %}
      <a href="/collections/{{artist}}" class="text-gray-800 no-underline">
      <li class="text-base empty:hidden ">{{card_product.metafields.my_fields.artist}}</li>
      </a>
      {%elsif my_meta.artist %}
      <li class="text-base empty:hidden ">
      <a href="/search?q={{artist}}" class="no-underline">{{card_product.metafields.my_fields.artist}}</a>
      </li>
      {%endif%}

      <!-- conditional list to show artist link either collection or by searh -->
      {% capture series %}{{my_meta.series | handle}}{%endcapture%}
      {%if collections[series].products.size != 0 %}
      <a href="/collections/{{my_meta.series | handle }}" class="text-gray-800 no-underline">
        <li class="text-base empty:hidden ">{{card_product.metafields.my_fields.series | truncate:15}}
        </li>
      </a>
      {%elsif my_meta.series %}
      
        <li class="text-base empty:hidden ">
          <a href="/search?q={{my_meta.series | handle }}" class="no-underline"></a>
          {{card_product.metafields.my_fields.series | truncate:15}}
          </a>
        </li>
      
      {%endif%}

      <!-- conditional list to show item type link either collection or by searh -->
      {% capture type %}{{my_meta.item_type | handle}}{%endcapture%}
      {%if collections[type].products.size != 0 %}
      <a href="/collections/{{type}}" class="text-gray-800 no-underline">
        <li class="text-base empty:hidden ">{{card_product.metafields.my_fields.item_type | truncate:15}}
        </li>
      </a>
      {%elsif my_meta.item_type %}
      <li class="text-base rounded-md empty:hidden">
      <a href="/search?q={{my_meta.item_type }}" class="text-gray-800 no-underline">{{card_product.metafields.my_fields.item_type | truncate:15}}</a>
      </li>
      {%endif%}
      
      <!-- conditional list to show product line link either collection or by searh -->
      {% capture lines %}{{my_meta.product_lines | handle}}{%endcapture%}
      {%if collections[lines].products.size != 0 %}
      <a href="/collections/{{lines}}" class="text-gray-800 no-underline">
        <li class="text-base empty:hidden ">{{card_product.metafields.my_fields.product_lines | truncate:15}}
        </li>
      </a>
      {%elsif my_meta.product_lines %}
      <li class="text-base empty:hidden ">
        <a href="/search?q={{my_meta.product_lines }}" class="text-gray-800 no-underline">{{card_product.metafields.my_fields.product_lines | truncate:15}}</a>
      </li>
      {%endif%}

      <!-- conditional list to show brand link either collection or by searh -->
      {% capture brand %}{{my_meta.brand | handle}}{%endcapture%}
      {%if collections[brand].products.size != 0 %}
      <a href="/collections/{{brand}}" class="text-gray-800 no-underline">
        <li class="text-base empty:hidden">
          {{card_product.metafields.my_fields.brand | truncate:15}}
        </li>
      </a>
      {%elsif my_meta.brand %}
      <li class="text-base break-words empty:hidden">
      <a href="/search?q={{my_meta.brand }}" class="text-gray-800 no-underline">{{card_product.metafields.my_fields.brand | truncate:15}}</a>
      </li>
      {%endif%}

      <!-- conditional list to show grade link either collection or by searh -->
      {% capture grade %}{{my_meta.grade | handle}}{%endcapture%}
      {%if collections[grade].products.size != 0 %}
      <a href="/collections/{{grade}}" class="text-gray-800 no-underline">
        <li class="text-base empty:hidden">{{card_product.metafields.my_fields.grade | truncate:15}}
        </li>
      </a>
      {%elsif my_meta.grade %}
      <li class="text-base empty:hidden ">
      <a href="/search?q={{my_meta.grade }}" class="text-gray-800 no-underline">{{card_product.metafields.my_fields.grade | truncate:15}}</a>
      </li>
      {%endif%}
    </div>
    
  </div>
  
  <!-- badge labels  -->
  <div class="absolute flex gap-x-2 -top-3 right-1 ">
    
    {% assign date_created = card_product.created_at | date:'%s' %}
  {% assign     date_now = 'now' | date:'%s' %}
  {% assign   difference = date_now | minus: date_created %}
  {% if difference < 3888000 %}
      <div class="flex items-center justify-center px-1 text-sm text-white rounded-md shadow-lg h-7 bg-emerald-500">New</div>
    {%endif%}
    {%if card_product.compare_at_price > card_product.price %}
      <div class="flex items-center justify-center px-1 text-sm text-white bg-pink-500 rounded-md shadow-lg h-7">Sale</div>
    {%endif%}
    {%- if card_product.available == false -%}
      <span class="flex items-center justify-center px-1 text-sm text-white bg-gray-500 rounded-md shadow-lg h-7">Soldout</span>
    {%endif%}
    {%- if card_product.variants.first.inventory_quantity == 1 -%}
      <span class="flex items-center justify-center px-1 text-base text-gray-800 bg-orange-500 rounded-md shadow-lg h-7">Last</span>
    {%endif%} 
    {% if card_product.metafields.ssw.review.count > '0' %}
      <div class="flex items-center justify-center h-5 px-1 bg-purple-100 rounded-md shadow-lg outline-purple-400 outline outline-1 ">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-purple-500" viewBox="0 0 20 20" fill="currentColor">
          <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
        </svg>
        <!-- <span class="text-base text-neutral-700">Review</span> -->
      </div>
    {%endif%} 
  </div>
  
  </div>

<!-- * commented out for later use 
  <div class="relative w-full overflow-hidden rounded-b-lg grid grid-cols-3 grid-rows-5 bg-transparent {%if card_product.type == 'Kpop CD'%} h-[35rem]{%else%} h-[37rem]{%endif%}">
  <div class="absolute w-[90%] left-[5%] h-full overflow-hidden text-center bg-white shadow-lg rounded-t-lg hover:scale-110 transform duration-200">
    {%if card_product.featured_media.aspect_ratio < 1 %}
    <img src="{{card_product.featured_media |img_url:'x350'}}" alt="" class="object-cover h-full ">
    {%elsif card_product.featured_media.aspect_ratio > 1.2 %}
    <img src="{{card_product.featured_media |img_url:'x350'}}" alt="" class="object-cover object-center max-h-[20rem] pt-[4rem]">
    {%else%}
    <img src="{{card_product.featured_media |img_url:'x350'}}" alt="" class="object-cover object-center w-full max-h-2/3">
    {%endif%}
  </div>
  <div class="absolute -bottom-[2rem] bg-slate-500 transform -skew-y-[5deg] h-[15rem] w-full shadow-lg">
  </div>
  <div class="relative flex flex-col items-center justify-center row-start-5 px-4 col-span-full">
    <div class="text-xl text-center text-gray-200 bg-clip-text">{{card_product.title | escape}}-{{card_product.featured_media.aspect_ratio}}</div>
  </div>
  <div class="relative flex items-center justify-center col-span-2 col-start-2 row-span-1 row-start-4 ">
    <div class="px-4 py-2 bg-amber-100 rounded-xl">{% render 'price', product: card_product, price_class: 'text-center' %}</div>
  </div>
</div> -->


{%comment%}
{%- if card_product and card_product != empty -%}
<div class="relative flex flex-col items-center justify-center h-[37rem] bg-gradient-to-b from-white via-white to-slate-300 overflow-hidden rounded-xl">
    {%if card_product.featured_media.aspect_ratio < 0.9 %}
    <div class="flex flex-col flex-shrink-0 w-full h-full">
      <img src="{{card_product.featured_media | img_url:'x350'}}" class="object-cover max-w-full h-[37rem]" alt="">
    </div>
    {%elsif card_product.featured_media.aspect_ratio > 1.2 %}
    <div class="flex flex-col items-center justify-center pb-[15rem] flex-shrink-0 w-full h-full ">
      <img src="{{card_product.featured_media | img_url:'350x'}}" class="object-cover w-[95%] " alt="">
    </div>
    {%else%}
    <div class="flex flex-col items-center flex-shrink-0 w-full h-full pb-[10rem]">
      <img src="{{card_product.featured_media | img_url:'350x'}}" class="object-cover w-[95%] " alt="">
    </div>
    {%endif%}
    <div class="absolute bottom-[1rem] w-5/6 h-[12rem] p-6 mx-auto text-xl  hover:bg-opacity-80 bg-white bg-opacity-60 backdrop-filter backdrop-blur-lg rounded-xl">
      {{card_product.title}} - {{card_product.featured_media.aspect_ratio}}
    </div>
</div>
{% endif %}              
{%endcomment%}